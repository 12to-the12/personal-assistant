#!/usr/bin/python

import subprocess
import os

def run_shellgpt_code_command(prompt):
    # Send the prompt to ShellGPT with the --code flag
    result = subprocess.run(['sgpt', '--code', prompt], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    if result.returncode != 0:
        raise Exception(f"ShellGPT Error: {result.stderr.decode('utf-8')}")
    return result.stdout.decode('utf-8')

def read_file_content(file_path):
    # Read the content of the specified file
    with open(file_path, 'r') as file:
        return file.read()

def generate_code(description):
    # Generate code based on the description
    return run_shellgpt_code_command(description)

def explain_code(file_path):
    # Explain the provided code snippet from a file
    code = read_file_content(file_path)
    explanation_prompt = f"Explain the following code in plain English:\n```python\n{code}\n```"
    return run_shellgpt_code_command(explanation_prompt)

def translate_code(file_path, target_language):
    # Translate code from a file to the target language
    code = read_file_content(file_path)
    translation_prompt = f"Translate the following code to {target_language}:\n```python\n{code}\n```"
    return run_shellgpt_code_command(translation_prompt)

def debug_code(file_path):
    # Suggest fixes for the provided code snippet from a file
    code = read_file_content(file_path)
    debug_prompt = f"Debug the following code:\n```python\n{code}\n```"
    return run_shellgpt_code_command(debug_prompt)

def main_menu():
    print("\nSelect an option:")
    print("1. Generate code")
    print("2. Explain code")
    print("3. Translate code")
    print("4. Debug code")
    print("5. Exit")
    return input("Enter your choice: ")

def main():
    print("Welcome to Code Assistant!")
    # Main loop to interact with the user
    while True:
        choice = main_menu()

        try:
            if choice == '1':
                desc = input("Describe the functionality you want to implement: ")
                print("Generated code:")
                print(generate_code(desc))
            elif choice in ['2', '3', '4']:
                file_path = input("Enter the path to the code file: ")
                if not os.path.isfile(file_path):
                    print("File does not exist. Please try again.")
                    continue

                if choice == '2':
                    print("Explanation:")
                    print(explain_code(file_path))
                elif choice == '3':
                    target_lang = input("Enter the target programming language: ")
                    print("Translated code:")
                    print(translate_code(file_path, target_lang))
                elif choice == '4':
                    print("Debug suggestions:")
                    print(debug_code(file_path))
            elif choice == '5':
                print("Exiting Code Assistant.")
                break
            else:
                print("Invalid choice. Please try again.")
        except Exception as e:
            print(f"An error occurred: {e}")

if __name__ == "__main__":
    main()